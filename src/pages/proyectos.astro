---
import Header from "../components/Header.astro";
import Layout from "../layouts/Layout.astro";
import Footer from "../components/Footer.astro";
import FloatingMenu from "../components/FloatingMenu.astro";
import MenuModal from "../components/MenuModal.astro";

import banoSevilla from "../assets/bano-sevilla.jpg";
import casaTrujillo from "../assets/casa-trujillo.jpg";
import casaVerde from "../assets/casa-verde.png";
import cocina2 from "../assets/cocina2.jpg";
import sala from "../assets/sala.png";
import terraza from "../assets/terraza.jpeg";
import terraza2 from "../assets/terraza2.png";
import AnimatedParagraph from "../components/AnimatedParagraph.astro";

const galleryImages = [
  casaTrujillo,
  sala,
  terraza,
  casaVerde,
  banoSevilla,
  cocina2,
  terraza2,
];
---

<Layout>
  <Header light={true} />
  <FloatingMenu triggerId="horizontal-scroll-section" />
  <MenuModal />

  <main class="bg-[#fcfcfc] text-[#151515]">
    <section id="horizontal-scroll-section" class="relative h-[350vh]">
      <div
        class="sticky top-0 h-screen w-full overflow-hidden flex flex-col px-7 pt-40 pb-8"
      >
        <div class="flex justify-between items-end w-full">
          <h1
            class="text-[8rem] font-bold tracking-tight uppercase leading-[0.85]"
          >
            <AnimatedParagraph duration={1.5}>
              Nuestros <br /> Proyectos
            </AnimatedParagraph>
          </h1>
          <div class="text-xl font-medium max-w-md mb-4">
            <AnimatedParagraph>
              Explora nuestra selección de trabajos más recientes, donde cada
              espacio cuenta una historia única de diseño, funcionalidad y
              estética atemporal.
            </AnimatedParagraph>
          </div>
        </div>

        <div class="mt-8 w-full h-0.5 bg-[#151515]/10 relative overflow-hidden">
          <div
            id="scroll-progress-line"
            class="absolute top-0 left-0 w-full h-full bg-[#151515] origin-left scale-x-0"
          >
          </div>
        </div>

        <div class="mt-auto -mx-7">
          <div
            id="horizontal-strip"
            class="flex gap-7 px-7 items-end will-change-transform"
          >
            {
              galleryImages.map((img) => (
                <div class="shrink-0 ">
                  <img
                    src={img.src}
                    alt="Proyecto"
                    class="max-w-100 max-h-85 w-full object-contain"
                  />
                </div>
              ))
            }
            <div class="shrink-0 w-[10vw] h-1"></div>
          </div>
        </div>
      </div>
    </section>

    <Footer />
  </main>

  <script>
    import { gsap } from "gsap";
    import { ScrollTrigger } from "gsap/ScrollTrigger";
    import Lenis from "lenis";

    gsap.registerPlugin(ScrollTrigger);

    const lenis = new Lenis();
    (window as any).lenis = lenis;
    lenis.on("scroll", ScrollTrigger.update);
    gsap.ticker.add((time) => {
      lenis.raf(time * 1000);
    });
    gsap.ticker.lagSmoothing(0);

    const initHorizontalScroll = () => {
      const section = document.querySelector("#horizontal-scroll-section");
      const strip = document.querySelector("#horizontal-strip");
      const progressLine = document.querySelector("#scroll-progress-line");

      if (!section || !strip || !progressLine) return;

      const getScrollAmount = () => {
        return strip.scrollWidth - window.innerWidth;
      };

      gsap.to(strip, {
        x: () => -getScrollAmount(),
        ease: "none",
        scrollTrigger: {
          trigger: section,
          start: "top top",
          end: "bottom bottom",
          scrub: 0.5,
          invalidateOnRefresh: true,
        },
      });

      gsap.to(progressLine, {
        scaleX: 1,
        ease: "none",
        scrollTrigger: {
          trigger: section,
          start: "top top",
          end: "bottom bottom",
          scrub: 0.5,
        },
      });
    };

    initHorizontalScroll();
    document.addEventListener("astro:after-swap", initHorizontalScroll);
  </script>
</Layout>
